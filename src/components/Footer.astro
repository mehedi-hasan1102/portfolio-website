---
import { Icon } from 'astro-icon/components';

const currentYear = new Date().getFullYear();

const socialLinks = [
  { name: 'GitHub', href: 'https://github.com/mehedi-hasan1102', icon: 'mdi:github' },
  { name: 'LinkedIn', href: 'https://www.linkedin.com/in/mehedi-hasan1102/', icon: 'mdi:linkedin' },
  { name: 'Email', href: 'mailto:mehedi.hasan11023@gmail.com', icon: 'mdi:email' },
  { name: 'Twitter', href: 'https://x.com/mehedihasan1102', icon: 'mdi:twitter' },
];

const mainPages = [
  { label: 'Home', href: '/' },
  { label: 'Blog', href: '/blog' },
  { label: 'Contact', href: '/' },
];

const resourcePages = [
  { label: 'Resume', href: '#' },
  { label: 'Projects', href: '#' },
  { label: 'Resources', href: '#' },
];
---

<footer class="mt-12 border-t border-gray-400 dark:border-gray-600 transition-colors bg-transparent text-black dark:text-white">
  <div class="max-w-3xl mx-auto px-6 py-12">
    <!-- Mobile Layout -->
    <div class="md:hidden space-y-8">
      <div class="flex justify-between gap-8">
        <!-- Main Links -->
        <nav>
          <h3 class="text-xs uppercase tracking-widest font-semibold mb-4">Main</h3>
          <ul class="space-y-3">
            {mainPages.map((link) => (
              <li>
                <a href={link.href} class="text-sm hover:underline transition-colors">
                  {link.label}
                </a>
              </li>
            ))}
          </ul>
        </nav>

        <!-- Resource Links -->
        <nav>
          <h3 class="text-xs uppercase tracking-widest font-semibold mb-4">Explore</h3>
          <ul class="space-y-3">
            {resourcePages.map((link) => (
              <li>
                <a href={link.href} class="text-sm hover:underline transition-colors">
                  {link.label}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </div>

      <!-- Brand Section -->
      <div class="border-t border-gray-400 dark:border-gray-600 pt-8 space-y-4">
        <h2 class="text-lg font-bold">Mehedi Hasan</h2>
        
        <!-- Social Links -->
        <div class="flex gap-4">
          {socialLinks.map((link) => (
            <a
              href={link.href}
              target="_blank"
              rel="noopener noreferrer"
              aria-label={link.name}
              class="flex items-center justify-center rounded-lg  text-gray-600 dark:text-gray-400  hover:text-gray-900 dark:hover:text-white transition-colors"
            >
              <Icon name={link.icon} class="w-5 h-5" />
            </a>
          ))}
        </div>

        <!-- Theme Toggle and Back to Top -->
        <div class="flex items-center gap-4 pt-4">
          <button id="scroll-to-top" class="text-xs hover:underline transition-colors">
            ↑ Back to top
          </button>
          <button id="theme-toggle-mobile" class="w-8 h-8 flex items-center justify-center rounded-md  transition-colors text-lg" aria-label="Toggle theme">
            <span class="block dark:hidden">☽</span>
            <span class="hidden dark:block">☀︎</span>
          </button>
        </div>

        <!-- Copyright -->
        <p class="text-xs">© {currentYear} Mehedi Hasan</p>
      </div>
    </div>

    <!-- Desktop Layout -->
    <div class="hidden md:grid grid-cols-3 gap-12">
      <!-- Brand Section -->
      <div class="space-y-4">
        <h2 class="text-lg font-bold">Mehedi Hasan</h2>
        
        <div class="flex gap-4">
          {socialLinks.map((link) => (
            <a
              href={link.href}
              target="_blank"
              rel="noopener noreferrer"
              aria-label={link.name}
              class=" flex items-center justify-center rounded-lg  transition-colors"
            >
              <Icon name={link.icon} class="w-5 h-5" />
            </a>
          ))}
        </div>

        <p class="text-xs">© {currentYear} Mehedi Hasan</p>
      </div>

      <!-- Main Pages -->
      <nav>
        <h3 class="text-xs uppercase tracking-widest font-semibold mb-5">Main</h3>
        <ul class="space-y-4">
          {mainPages.map((link) => (
            <li>
              <a href={link.href} class="text-sm hover:underline transition-colors">
                {link.label}
              </a>
            </li>
          ))}
        </ul>
      </nav>

      <!-- Explore Pages -->
      <nav>
        <h3 class="text-xs uppercase tracking-widest font-semibold mb-5">Explore</h3>
        <ul class="space-y-4">
          {resourcePages.map((link) => (
            <li>
              <a href={link.href} class="text-sm hover:underline transition-colors">
                {link.label}
              </a>
            </li>
          ))}
        </ul>

        <!-- Theme Toggle and Back to Top -->
        <div class="flex items-center gap-4 pt-8">
          <button id="scroll-to-top-desktop" class="text-xs hover:underline transition-colors">
            ↑ Back to top
          </button>
          <button id="theme-toggle-desktop" class="w-8 h-8 flex items-center justify-center rounded-md    transition-colors text-lg" aria-label="Toggle theme">
            <span class="block dark:hidden">☽</span>
            <span class="hidden dark:block">☀︎</span>
          </button>
        </div>
      </nav>
    </div>
  </div>
</footer>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  function scrollToTop() {
    gsap.to(window, {
      duration: 0.8,
      scrollTo: { y: 0 },
      ease: 'power3.inOut'
    });
  }

  function toggleTheme() {
    const html = document.documentElement;
    const body = document.body;
    const footer = document.querySelector('footer');
    const isDark = html.classList.contains('dark');
    
    // Disable transitions temporarily to prevent flicker
    html.style.transition = 'none';
    body.style.transition = 'none';
    if (footer) footer.style.transition = 'none';
    
    // Toggle the dark class immediately
    if (isDark) {
      html.classList.remove('dark');
    } else {
      html.classList.add('dark');
    }
    
    // Force a reflow to apply changes immediately
    void html.offsetHeight;
    
    // Re-enable transitions
    setTimeout(() => {
      html.style.transition = '';
      body.style.transition = '';
      if (footer) footer.style.transition = '';
    }, 0);
    
    // Update localStorage for persistence
    const newTheme = html.classList.contains('dark') ? 'dark' : 'light';
    localStorage.setItem('theme', newTheme);
    
    // Dispatch custom event for any listeners
    window.dispatchEvent(new CustomEvent('themechange', { detail: { theme: newTheme } }));
  }

  function animateFooter() {
    // Animate footer on scroll into view
    gsap.from('footer', {
      scrollTrigger: {
        trigger: 'footer',
        start: 'top 90%',
        toggleActions: 'play none none none'
      },
      duration: 1,
      opacity: 0,
      y: 50,
      ease: 'power3.out'
    });

    // Animate footer headings
    document.querySelectorAll('footer h2, footer h3').forEach((heading) => {
      gsap.from(heading, {
        scrollTrigger: {
          trigger: heading,
          start: 'top 90%',
          toggleActions: 'play none none none'
        },
        duration: 0.8,
        opacity: 0,
        x: -20,
        ease: 'power2.out'
      });
    });

    // Animate social links with stagger
    document.querySelectorAll('footer a[aria-label]').forEach((link, index) => {
      gsap.from(link, {
        scrollTrigger: {
          trigger: 'footer',
          start: 'top 85%',
          toggleActions: 'play none none none'
        },
        duration: 0.6,
        opacity: 0,
        scale: 0,
        delay: index * 0.1,
        ease: 'back.out'
      });

      // Add hover animation
      link.addEventListener('mouseenter', () => {
        gsap.to(link, {
          duration: 0.3,
          scale: 1.2,
          y: -5,
          ease: 'power2.out'
        });
      });

      link.addEventListener('mouseleave', () => {
        gsap.to(link, {
          duration: 0.3,
          scale: 1,
          y: 0,
          ease: 'power2.out'
        });
      });
    });

    // Animate footer links
    document.querySelectorAll('footer nav a').forEach((link) => {
      link.addEventListener('mouseenter', () => {
        gsap.to(link, {
          duration: 0.3,
          x: 5,
          ease: 'power2.out'
        });
      });

      link.addEventListener('mouseleave', () => {
        gsap.to(link, {
          duration: 0.3,
          x: 0,
          ease: 'power2.out'
        });
      });
    });

    // Add animation to back to top button
    document.querySelectorAll('[id^="scroll-to-top"]').forEach((btn) => {
      btn.addEventListener('mouseenter', () => {
        gsap.to(btn, {
          duration: 0.3,
          y: -3,
          ease: 'power2.out'
        });
      });

      btn.addEventListener('mouseleave', () => {
        gsap.to(btn, {
          duration: 0.3,
          y: 0,
          ease: 'power2.out'
        });
      });
    });

    // Add animation to theme toggle buttons
    document.querySelectorAll('[id^="theme-toggle"]').forEach((btn) => {
      btn.addEventListener('mouseenter', () => {
        gsap.to(btn, {
          duration: 0.3,
          scale: 1.15,
          rotate: 20,
          ease: 'power2.out'
        });
      });

      btn.addEventListener('mouseleave', () => {
        gsap.to(btn, {
          duration: 0.3,
          scale: 1,
          rotate: 0,
          ease: 'power2.out'
        });
      });
    });
  }

  // Wait for DOM to be ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      // Setup scroll to top buttons
      document.querySelectorAll('[id^="scroll-to-top"]').forEach(btn => {
        (btn as HTMLButtonElement).onclick = scrollToTop;
      });

      // Setup theme toggle buttons
      document.querySelectorAll('[id^="theme-toggle"]').forEach(btn => {
        (btn as HTMLButtonElement).onclick = toggleTheme;
      });

      animateFooter();
    });
  } else {
    // DOM already loaded
    document.querySelectorAll('[id^="scroll-to-top"]').forEach(btn => {
      (btn as HTMLButtonElement).onclick = scrollToTop;
    });

    document.querySelectorAll('[id^="theme-toggle"]').forEach(btn => {
      (btn as HTMLButtonElement).onclick = toggleTheme;
    });

    animateFooter();
  }
  
  // Listen for theme changes from other sources
  window.addEventListener('themechange', function() {
    // Theme change handled
  });
</script>
